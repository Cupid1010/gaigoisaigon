<div class="detailProduct mt 5 pt-5">
    <div class="row">
        <div class="col-md-8 col-sm-12 detailProduct__img">
        
            <div class="detailProduct__img--main">
                       <div class="btn-open-modal" style="cursor: pointer;" data-toggle="modal" data-target="#ProductImgZoomModal">
                            <img src="{{productInfor.productImg.[0]}}" alt="">

                        </div>
                        <div class="detailProduct__zoomIn--Btn">
                            <button class="btn-open-modal" data-toggle="modal" data-target="#ProductImgZoomModal">
                                    <img src="/img/Icons/zoom.png" alt="">
                            </button>
                        </div>
                    
            </div>

            <div class="detailProduct__img--list">
                
                  <button class="btn-open-modal btn-open-modal-img">
                                    {{#activeFirstProuctImg}}
                                         {{productInfor}}
                                     {{/activeFirstProuctImg}}           
                 </button>
             

                   
            </div>
        </div>
        <div class="col-md-4 col-sm-12 detailProduct__content">
            <input type="hidden" id='productId' value='{{productInfor._id}}'>
            <h1 class="detailProduct__content--name border-bottom">
                {{productInfor.productName}}
                <div class='detailProduct__content--name-des'>
                    <div class='detailProduct__content--name-des__wraper'>Tuổi:
                        <h5 class='detailProduct__content--name-des__content'>  {{productInfor.age}}
                            
                        </h5> 
                        <span>|</span>
                    </div>

                    <div class='detailProduct__content--name-des__wraper'>Mã SP:<h5 class='detailProduct__content--name-des__content'>{{productInfor.productCode}}</h5> 
                    </div>

                    
                </div>
            </h1>

            <h2 class="detailProduct__content--price border-bottom">
                   {{#if productInfor.sale includeZero=false}}
                        <span class='product__newPrice detailProduct__price' data-price='{{productInfor.productSalePrice}}'>{{number
                            productInfor.productSalePrice
                          }}₫</span>
                        <span class='product__oldPrice detailProduct__price'>{{number productInfor.productPrice}}₫</span>
                        <div class="productDetail__sale--percent p-2 bg-red">
                            <span class=''>Giảm {{productInfor.sale}}% </span>
                        </div>
                        
                        
                        {{else}}
                        <span class='product__oldPrice--notsale detailProduct__price' data-price='{{productInfor.productPrice}}'>{{number productInfor.productPrice}}₫
                            
                        </span>

                      {{/if}}


                      {{#if productInfor.isPreOrder}}
                            <div class="productDetail__preOrder p-2">
                                <div class="productDetail__sale--percent">
                                    <span>
                                        Order
                                </span>
                                </div>
                            </div>
                        {{/if}}
            </h2>

         
           
    

            {{!-- gaigoi --}}
            <div class="productColor py-3 border-bottom d-flex">
                <h6 class="productColor__title detailProduct__content--title">Số điện thoại</h6>
                <div class="productColor__content">
                    <div class='w-100'>

                      <p  style= "" class=" productColor__text text-center m-0 p-2 text-uppercase font-weight-bold" >{{productInfor.productPhoneNumber}}</p>
                    </div>
                </div>
              
            </div>
            <div class="productColor py-3 border-bottom d-flex">
                <h6 class="productColor__title detailProduct__content--title">Năm sinh</h6>
                <div class="productColor__content">
                    <div class='w-100'>

                      <p  style= "" class=" productColor__text text-center m-0 p-2 text-uppercase font-weight-bold" >{{productInfor.yearsOfBirth}}</p>
                    </div>
                </div>
              
            </div>
            <div class="productColor py-3 border-bottom d-flex">
                <h6 class="productColor__title detailProduct__content--title">Chiều cao</h6>
                <div class="productColor__content">
                    <div class='w-100'>

                      <p  style= "" class=" productColor__text text-center m-0 p-2 text-uppercase font-weight-bold" >{{productInfor.height}} cm</p>
                    </div>
                </div>
              
            </div>
            <div class="productColor py-3 border-bottom d-flex">
                <h6 class="productColor__title detailProduct__content--title">Cân nặng</h6>
                <div class="productColor__content">
                    <div class='w-100'>

                      <p  style= "" class=" productColor__text text-center m-0 p-2 text-uppercase font-weight-bold" >{{productInfor.weight}} kg</p>
                    </div>
                </div>
              
            </div>
            <div class="productColor py-3 border-bottom d-flex">
                <h6 class="productColor__title detailProduct__content--title">Số đo 3 vòng</h6>
                <div class="productColor__content">
                    <div class='w-100'>

                      <p  style= "" class=" productColor__text text-center m-0 p-2 text-uppercase font-weight-bold" >{{productInfor.threeRingMeasurements}}</p>
                    </div>
                </div>
              
            </div>
            <div class="productColor py-3 border-bottom d-flex">
                <h6 class="productColor__title detailProduct__content--title">Khu vực</h6>
                <div class="productColor__content">
                    <div class='w-100'>

                      <p  style= "" class=" productColor__text text-center m-0 p-2 text-uppercase font-weight-bold" >{{productInfor.brand}}</p>
                    </div>
                </div>
              
            </div>
            <div class="productColor py-3 border-bottom d-flex">
                <h6 class="productColor__title detailProduct__content--title">Làm việc</h6>
                <div class="productColor__content">
                    <div class='w-100'>

                      <p  style= "" class=" productColor__text text-center m-0 p-2 text-uppercase font-weight-bold" >{{productInfor.workingTime}}</p>
                    </div>
                </div>
              
            </div>
            <div class="productColor py-3 border-bottom d-flex">
                <h6 class="productColor__title detailProduct__content--title">Dịch vụ</h6>
                <div class="productColor__content">
                    <div class='w-100'>

                      <p  style= "" class=" productColor__text text-center m-0 p-2 text-uppercase font-weight-bold" >{{productInfor.services}}</p>
                    </div>
                </div>
              
            </div>

            

            <div class="selector-actions py-3">
                {{!-- <div class="quantity-area clearfix">
                    <input type="button" value="-" onclick="minusQuantity()" class="qty-btn">
                    <input type="text" id="quantity" name="quantity" value="1" min="1" class="quantity-selector"  disabled="disabled">
                    <input type="button" value="+" onclick="plusQuantity()" class="qty-btn">
                </div> --}}
                
                {{!-- <div class='mt-4'>
                    {{> slideBtn title="Thêm vào giỏ hàng"}}
                </div> --}}

           
                {{!-- <button type="button" class="addToCart-btn btn btn-demo btn-lg btn-warning" data-toggle="modal" data-target="#cartModal" data-whatever="{{productInfor}}">
			            Thêm vào giỏ hàng
		        </button> --}}

                <!-- Modal -->
                    <div class="modal right fade" id="cartModal" tabindex="-1" role="dialog" aria-labelledby="cartModalLabel2">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">

                                <div class="modal-header">
                                    <h4 class="modal-title" id="cartModalLabel2">Giỏ hàng</h4>
                                    <button type="button" class="close close-cartModal-btn" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true"><i class="fa-solid fa-circle-xmark"></i></span>
                                    <button>
                                </div>

                                <div class="modal-body">
                                     <p class='cart__quality text-center  mt-4 mb-5'>Bạn có 
                                         <span class='cart__quality--number'></span> sản phẩm trong giỏ hàng</p>
                                    <ul class="cart__list">
                                    </ul>
                                    <div class="d-flex justify-content-between my-5">
                                        <span class='font-weight-bold'>TỔNG TIỀN</span> <span class='cart__total--money'></span>
                                    </div>
                                    <div class="cartBtn__container justify-content-between">
                                        <a href="/cart">{{> slideBtn title="Xem giỏ hàng"}}</a>

                                        <span href="">
                                             {{> slideBtn title="Thanh toán" class="pay__btn"}}
                                        </span>
                                        
                                           
                                    </div>

                                </div>

                            </div><!-- modal-content -->
                        </div><!-- modal-dialog -->
                    </div>
                <!-- modal -->


                {{!-- gaigoi --}}
                <!-- HTML !-->


                <a  target='_blank' href="https://t.me/+84392686494">
                      <button class="button-34 d-flex align-items-center" role="button">Book ngay <i style='font-size:25px'class="fa-brands fa-telegram ml-3"></i></button>
                </a>
              
			</div>

            

        
        </div>
        
        <div class="col-12">
            <h3 class='collection__header-link mt-5 pt-5'>Gái gọi liên quan</h3>
            <div class="row mb-4">
                
                {{#each products}}

                    <div class='product__item col-6 col-sm-6 col-md-4 col-lg-2'>
                        {{> productItem }}
                    </div>
                {{/each}}

            </div>
        </div>
    

         {{!-- product Video --}}
         <div class="col-12">
            <div class="row pt-5">
                {{#each productInfor.productVideo}}
                <div class="col-12 col-md-6 mb-5">
                  <video width="100%" height="100%" poster="{{productInfor.productImg.[0]}}" controls>
                    <source src="{{this}}" type="video/mp4">
                    
                    
                    </video>
                </div>
                {{/each}}
               
            </div>
        </div>

        {{!-- //product IMG --}}
        <div class="col-12">
            <div class="row pt-5">
                {{#each productInfor.productImg}}
                <div class="col-12 col-md-6 mb-5">
                    <img src="{{this}}" style='width:100%' alt="">
                </div>
                {{/each}}
               
            </div>
        </div>
        
    </div>




    {{!-- <button type="button" class="addToCart-btn addToCart-btn-sticky btn btn-demo btn-lg btn-warning" data-toggle="modal" data-target="#cartModal" data-whatever="{{productInfor}}">
        <i class="fa-solid fa-cart-plus"></i>
			Thêm vào giỏ hàng
	</button> --}}
</div>


{{!-- Modal --}}

<!-- Modal Fullscreen xl -->
<div class="modal ProductImgZoomModal" id="ProductImgZoomModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
     
      <div class="modal-body">
            <div id="ProductImgZoom" class="carousel slide" data-ride="carousel">
                <button type="button" class="close closeBtn" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true"><i class="closeBtn__icon fa-regular fa-circle-xmark"></i></span>
                </button>  

                  <ol class="carousel-indicators">
                    {{#each productInfor.productImg}} 

                    <li data-target="#ProductImgZoom" data-slide-to="{{@index}}" class=""></li>
            
                    {{/each}}

                </ol>
                <div class="carousel-inner">   

                    {{#each productInfor.productImg}} 
                    
                         <div class="carousel-item">
                            <img class="d-block" src="{{this}}" alt="First slide">
                        </div>
                    {{/each}}
         
                </div>
                <a class="carousel-control-prev" href="#ProductImgZoom" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#ProductImgZoom" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
         </div>
      </div>
    </div>
  </div>
</div>

{{>modalUserInfor}}

{{!-- viewmore --}}
<script>
    const descElement = document.querySelector('.productDesc');
    const viewMoreDescElement = document.querySelector('.view-more-desc');

    let descElementHeight = descElement.offsetHeight;
    let newDescElementHeight = (descElementHeight*20/100).toFixed();

    descElement.style.height = newDescElementHeight + "px";
  

   
    function toggleDescContent() {
        if(descElement.classList.contains('hide')) {
             descElement.style.height = descElementHeight + "px";
        }
        else {
             descElement.style.height = newDescElementHeight + "px";

        }
        descElement.classList.toggle('hide');

    }

    viewMoreDescElement.addEventListener('click',toggleDescContent)
    descElement.addEventListener('click',toggleDescContent)

  

    

</script>

<script>


    const selectSizeBtns = document.querySelectorAll('.selectSize__btn--item');
   
    //Select size
    selectSizeBtns.forEach((item)=> {
        item.addEventListener('click',(e)=> {
            document.querySelector('.selectSize__btn--item.active').classList.remove('active');
            e.target.classList.add('active');
        })
    })

    // Change IMG main

    const productImgList = document.querySelectorAll('.detailProduct__img--item');

    function changeActiveImg (e) {
            const imgActiveElement = document.querySelector('.detailProduct__img--item.active');

            imgActiveElement && imgActiveElement.classList.remove('active');

            e.target.classList.add('active');
            document.querySelector('.detailProduct__img--main img').src=e.target.src;
    }

    productImgList.forEach((item) => {
        item.addEventListener('click', (e) => {
            changeActiveImg(e);
        })
    })
    productImgList.forEach((item) => {
        item.addEventListener('dblclick', (e) => {
            $('#ProductImgZoomModal').modal('show')
        })
    })
   
    // Active img main
    productImgList.forEach((item)=> {
        item.addEventListener('mouseover',(e)=> {
            e.stopPropagation();
            changeActiveImg(e)

        })
    })

    //changeProductQuantity
     
       
        function plusQuantity() {
            const currentQuantity = document.getElementById('quantity').value;

            document.getElementById('quantity').value = Number(currentQuantity) + 1;
            
        }
        function minusQuantity() {

        
            const currentQuantity = Number(document.getElementById('quantity').value);
            
            if(currentQuantity > 1) {
                document.getElementById('quantity').value =currentQuantity - 1;

            }
            
        }


   

   
    // show modal cart
    $('#cartModal').on('show.bs.modal',async function (event) {
        var button = $(event.relatedTarget) 

       

        const cartItemId = document.querySelector('#productId').value;

        const productInfor =await fetch(`/products/infor/${cartItemId}`).then((res)=> {
            return res.json();
        }).then(productInfor=> {
            return productInfor
        })

        const cartItemImgUrl = `{{productAvatar}}`

        const cartItemName = document.querySelector('.detailProduct__content--name').innerText;

        const cartItemSize = Number(document.querySelector('.selectSize__btn--item.active').textContent);

        const cartItemColor = document.querySelector('.productColor__text').textContent;

        const cartItemAmount = Number(document.getElementById('quantity').value);

        const cartItemPrice = Number(document.querySelector('.detailProduct__price').dataset.price);

      

        const cartItemPriceString =  numberToMoney(cartItemPrice);



        const cartItemInfor = {
            cartItemId,
            cartItemImgUrl,
            cartItemName,
            cartItemSize,
            cartItemColor,
            cartItemAmount,
            cartItemPrice,
            cartItemSlug: productInfor.slug,
            cartItemPriceString,
        }

        // Add item to cart list in localstorage


           const localListCart = JSON.parse(localStorage.getItem('cartProductList'));

           if(localListCart !== null) {
                const haveStoraged = localListCart.some((item)=> item.cartItemId === cartItemInfor.cartItemId && item.cartItemSize === cartItemInfor.cartItemSize);


                if(haveStoraged) {
                        localListCart.map(item=> {
                            if(item.cartItemId === cartItemInfor.cartItemId) {
                                item.cartItemAmount = item.cartItemAmount + cartItemAmount
                            }
                            return item
                        })
                }
                else {
                    localListCart.push(cartItemInfor)
                }

                // save to store
                localStorage.setItem('cartProductList',JSON.stringify(localListCart))

                // render UI
                renderListCart(localListCart)
           }
                
           else {
              localStorage.setItem('cartProductList',JSON.stringify([cartItemInfor]))
              renderListCart([cartItemInfor])
           }

        

        var modal = $(this)
        // modal.find('.modal-title').text('New message to ' + recipient)

      //  modal.find('.modal-body input').val(productInfor)

        })

    // Auto update cart item when have change

   

        $('#ProductImgZoomModal').on('show.bs.modal', function (e) {

            const activeImgIndex = Number(document.querySelector('.detailProduct__img--item.active').dataset.index);


            const carouselInnerElement = document.querySelectorAll('#ProductImgZoom .carousel-inner .carousel-item');
            
            const carouselDotsElemement = document.querySelectorAll('#ProductImgZoom .carousel-indicators li');

            function addActiveClassFunction (elements) {
             elements.forEach((item,index)=> {
                if(index === activeImgIndex) {
                    item.classList.add('active');
                }
                else {
                    item.classList.remove('active');
                }
            })
            }
            addActiveClassFunction(carouselInnerElement);
            addActiveClassFunction(carouselDotsElemement);

         

        })

        $('#ProductImgZoom').carousel({
            interval: false,
        });

</script>
<script src='/js/renderCart.js'></script>
<script src='/js/payment.js'></script>